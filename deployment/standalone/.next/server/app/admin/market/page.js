(()=>{var e={};e.id=7820,e.ids=[7820],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},49727:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>g,tree:()=>c});var a=r(50482),s=r(69108),l=r(62563),i=r.n(l),o=r(68300),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);r.d(t,n);let c=["",{children:["admin",{children:["market",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,23503)),"E:\\copycoder-2025-04-13T00-58-05-829Z\\src\\app\\admin\\market\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,86003))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,61711)),"E:\\copycoder-2025-04-13T00-58-05-829Z\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,86003))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["E:\\copycoder-2025-04-13T00-58-05-829Z\\src\\app\\admin\\market\\page.tsx"],m="/admin/market/page",u={require:r,loadChunk:()=>Promise.resolve()},g=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/market/page",pathname:"/admin/market",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},78345:(e,t,r)=>{Promise.resolve().then(r.bind(r,28977))},71532:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},55313:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]])},42739:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},51838:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},33733:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},31498:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},28765:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},46327:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]])},38271:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},28977:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>T});var a=r(95344),s=r(3729),l=r(90521),i=r(8428),o=r(56506),n=r(63020),c=r(71532),d=r(42739),m=r(33733),u=r(28765),g=r(51838),p=r(66138),h=r(69224);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,h.Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var y=r(73714);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,h.Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);var b=r(46327),k=r(38271),w=r(55313),v=r(14513),j=r(31498),N=r(15532),S=r(44669),U=r(73890),$=r(60139);let C="slotjack_market_items",P="market_items";function T(){let e=(0,i.useRouter)(),t=(0,l.useAuth)(),[r,h]=(0,s.useState)(!0),[T,E]=(0,s.useState)([]),[A,I]=(0,s.useState)(""),[Z,q]=(0,s.useState)(!1),[M,D]=(0,s.useState)(null),[z,_]=(0,s.useState)(null),[L,R]=(0,s.useState)(null),[F,Y]=(0,s.useState)(!1),[O,J]=(0,s.useState)(null),[V,G]=(0,s.useState)(!1),[B,H]=(0,s.useState)(!1),[K,X]=(0,s.useState)(null),[Q,W]=(0,s.useState)({}),[ee,et]=(0,s.useState)({name:"",price:0,points:0,category:"betting",description:"",imageUrl:"",stock:-1,featured:!1,virtual:!1,priceType:"TRY"}),[er,ea]=(0,s.useState)({name:"",points:3500,imageUrl:"/market-img/zlat.png"}),[es,el]=(0,s.useState)([]);if(!t)throw Error("AuthContext is undefined");let{user:ei}=t;(0,s.useEffect)(()=>{if(!r&&(!ei||ei.rank!==n.X.ADMIN)){e.push("/");return}ei&&(eo(),h(!1))},[ei,r,e]);let eo=async()=>{try{h(!0),J(null);let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{console.log("Trying to load market items from API...");let r=await fetch("/api/market/items",{cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:e.signal});if(clearTimeout(t),r.ok){let e=await r.json();if(console.log("Loaded items from API:",e.items?.length||0),e.items&&e.items.length>0){let t=Date.now(),r=e.items.map(e=>e.imageUrl&&!e.imageUrl.includes("?")?{...e,imageUrl:`${e.imageUrl}?t=${t}`}:e);E(r),localStorage.setItem(C,JSON.stringify(r)),h(!1);return}throw console.log("API returned empty items array"),Error("API returned empty items array")}throw console.error(`Error from API (${r.status})`),Error(`API error: ${r.status}`)}catch(e){clearTimeout(t),console.error("Error fetching from API:",e),"AbortError"===e.name&&console.error("API request timed out")}for(let e=1;e<=2;e++)try{console.log(`Trying direct Supabase access (attempt ${e}/2)...`);let t=await em(),{data:r,error:a}=await t.from(P).select("*").order("id");if(a){if(console.error(`Error loading items from Supabase (attempt ${e}):`,a),e<2){await new Promise(e=>setTimeout(e,1e3));continue}throw a}if(r&&r.length>0){console.log("Loaded items from Supabase:",r.length);let e=Date.now(),t=r.map(t=>t.imageUrl&&!t.imageUrl.includes("?")?{...t,imageUrl:`${t.imageUrl}?t=${e}`}:t);E(t),localStorage.setItem(C,JSON.stringify(t)),h(!1);return}throw console.log("No items found in Supabase"),Error("No items found in Supabase")}catch(t){if(e<2){await new Promise(e=>setTimeout(e,1e3));continue}console.error("All Supabase attempts failed:",t)}try{console.log("Trying localStorage...");let e=localStorage.getItem(C);if(e){let t=JSON.parse(e);if(Array.isArray(t)&&t.length>0){console.log(`Loaded ${t.length} items from localStorage`),E(t),h(!1),S.toast.error("\xc7evrimdışı mod: Sunucu bağlantısı kurulamadı, yerel veriler kullanılıyor",{icon:"\uD83D\uDCF1",duration:5e3});return}}throw Error("No items found in localStorage")}catch(e){console.error("Error reading from localStorage:",e)}console.log("All data sources failed. Using empty items array"),E([]),S.toast.error("Veriler y\xfcklenemedi! \xdcr\xfcn ekleyerek başlayabilirsiniz.",{duration:5e3})}catch(e){console.error("Error in loadMarketItems:",e),J("Market \xfcr\xfcnleri y\xfcklenemedi: "+(e instanceof Error?e.message:String(e)))}finally{h(!1)}},en=async e=>{let t=0;for(;t<=2;)try{t>0&&(console.log(`Retry attempt ${t}/2 for Supabase save...`),await new Promise(e=>setTimeout(e,1e3*t))),console.log("Connecting to Supabase...");let r=await (0,U.e)();try{let{error:e}=await r.from("health_check").select("*").limit(1).maybeSingle();if(e&&!e.message.includes("does not exist"))throw e}catch(e){if(e.message&&e.message.includes("does not exist"))console.log("Supabase connection test OK (table not found)");else throw e}console.log("Deleting existing items...");let{error:a}=await r.from(P).delete().not("id","eq","");if(a)return console.error("Error deleting existing items:",a),{success:!1,message:a.message};console.log(`Inserting ${e.length} items...`);let{data:s,error:l}=await r.from(P).insert(e).select();if(l)return console.error("Error inserting items:",l),{success:!1,message:l.message};return console.log("Successfully saved items to Supabase:",s?.length||0),{success:!0,message:`Saved ${s?.length||0} items to database`}}catch(r){let e=r instanceof Error?r.message:String(r);if(console.error(`Supabase save attempt ${t+1} failed:`,e),t>=2)return console.error("All Supabase save attempts failed"),{success:!0,message:"Saved to local storage only (offline mode)"};t++}return{success:!1,message:"Unknown error saving items"}},ec=()=>{try{localStorage.setItem("market_items_updated",Date.now().toString()),window.dispatchEvent(new CustomEvent("market-items-updated",{detail:{source:"admin-panel",timestamp:Date.now()}})),console.log("Broadcast market item changes to all tabs/windows")}catch(e){console.error("Error broadcasting changes:",e)}},ed=async e=>{if(confirm("Bu \xfcr\xfcn\xfc silmek istediğinizden emin misiniz?"))try{X(e);try{let t=await fetch(`/api/market/items?id=${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate"},cache:"no-store"}),r=await t.json();if(r.success)console.log("Item deleted via API successfully");else throw Error(r.error||"API delete failed")}catch(a){console.error("API delete failed, trying direct Supabase delete",a);let t=await em(),{error:r}=await t.from(P).delete().eq("id",e);if(r)throw console.error("Supabase delete failed too:",r),r}let t=T.filter(t=>t.id!==e);E(t),localStorage.setItem(C,JSON.stringify(t)),S.toast.success("\xdcr\xfcn başarıyla silindi"),ec()}catch(e){console.error("Error deleting item:",e),S.toast.error("\xdcr\xfcn silinirken bir hata oluştu")}finally{X(null)}},em=async()=>{let e=null;for(let t=1;t<=2;t++)try{console.log(`Creating Supabase client (attempt ${t}/2)...`);let e=await (0,U.e)();try{let{error:t}=await e.from("health_check").select("*").limit(1).maybeSingle();if(t&&!t.message.includes('relation "health_check" does not exist')&&!t.message.includes("does not exist"))throw t;return console.log("Supabase client created successfully"),e}catch(t){if(t.message&&(t.message.includes('relation "health_check" does not exist')||t.message.includes("does not exist")))return console.log("Supabase connection good (health check table not found)"),e;throw t}}catch(r){if(e=r,console.error(`Failed to create Supabase client (attempt ${t}/2):`,r),t<2){let e=Math.min(1e3*Math.pow(2,t-1),4e3);console.log(`Retrying in ${e}ms...`),await new Promise(t=>setTimeout(t,e))}}throw console.error("Failed to create Supabase client after 2 attempts"),e||Error("Failed to create Supabase client")},eu=T.filter(e=>""===A||e.name.toLowerCase().includes(A.toLowerCase())||e.category.toLowerCase().includes(A.toLowerCase())||e.description.toLowerCase().includes(A.toLowerCase())),eg=()=>{D(null),et({name:"",price:0,points:0,category:"betting",description:"",imageUrl:"",stock:-1,featured:!1,virtual:!1,priceType:"TRY"}),_(null),R(null),q(!0),J(null)},ep=e=>{J(null),D(e.id);let t=0,r="TRY";"string"==typeof e.price?e.price.includes("$")?(t=Number(e.price.replace("$","")),r="USD"):e.price.includes("₺")?(t=Number(e.price.replace("₺","")),r="TRY"):t=Number(e.price):"number"==typeof e.price?t=e.price:"number"==typeof e.priceValue&&(t=e.priceValue);let a=e.imageUrl||"";a.includes("?")&&(a=a.split("?")[0]),et({id:e.id,name:e.name||"",price:t,points:Number(e.points),category:e.category||"",description:e.description||"",imageUrl:a,stock:null!==e.stock?Number(e.stock):0,featured:!!e.featured,virtual:!!e.virtual,priceType:r}),_(null),R(a),q(!0)},eh=async()=>{console.log("Refreshing market items data with cache busting..."),G(!0);try{let e=Date.now(),t=await fetch(`/api/market/items?t=${e}`,{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},next:{revalidate:0}});if(!t.ok)throw Error(`API error: ${t.status}`);let r=await t.json();if(r.success&&r.items)console.log(`Loaded ${r.items.length} items from API`),E(r.items),localStorage.setItem(C,JSON.stringify(r.items));else throw console.error("API returned success: false or no items"),Error("Failed to load market items")}catch(e){console.error("Error refreshing data:",e),S.toast.error("Veri yenileme hatası. Yerel \xf6nbellek kullanılıyor.");try{let e=localStorage.getItem(C);if(e){let t=JSON.parse(e);E(t),console.log(`Loaded ${t.length} items from localStorage`)}}catch(e){console.error("Error loading from localStorage:",e)}}finally{G(!1)}},ex=(e,t)=>"USD"===t?`${e}$`:"TRY"===t?`${e}₺`:`${e}`,ey=async(e,t)=>{console.log(`Uploading image: ${e.name}, size: ${e.size}, type: ${e.type}`),console.log(`Old image URL: ${t||"none"}`),H(!0);let r=null;for(let a=1;a<=2;a++)try{console.log(`Upload attempt ${a}/2`);let r=new FormData;r.append("file",e);let s=new AbortController,l=setTimeout(()=>s.abort(),1e4);if(t){r.append("oldImageUrl",t),console.log("Using PUT method to update existing image");let e=await fetch("/api/upload/market-images",{method:"PUT",body:r,cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:s.signal});if(clearTimeout(l),!e.ok){let t=await e.json().catch(()=>({error:`Upload failed: ${e.status}`}));throw console.error(`Upload failed with status ${e.status}:`,t),Error(t.error||`Upload failed: ${e.status}`)}let a=await e.json();return console.log("Image updated successfully:",a),`${a.fileUrl}?t=${Date.now()}`}{console.log("Using POST method to upload new image");let e=await fetch("/api/upload/market-images",{method:"POST",body:r,cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:s.signal});if(clearTimeout(l),!e.ok){let t=await e.json().catch(()=>({error:`Upload failed: ${e.status}`}));throw console.error(`Upload failed with status ${e.status}:`,t),Error(t.error||`Upload failed: ${e.status}`)}let t=await e.json();return console.log("Image uploaded successfully:",t),`${t.fileUrl}?t=${Date.now()}`}}catch(e){if(r=e,console.error(`Image upload attempt ${a} failed:`,e),"AbortError"===e.name)console.error("Upload request timed out"),a<2&&(console.log("Upload timed out. Retrying in 2000ms..."),await new Promise(e=>setTimeout(e,2e3)));else if(a<2){let e=Math.min(1e3*Math.pow(2,a-1),4e3);console.log(`Retrying upload in ${e}ms...`),await new Promise(t=>setTimeout(t,e))}}return(console.error("All 2 upload attempts failed:",r),t)?(console.log("Returning original image URL as fallback:",t),t):(console.log("Using default placeholder image"),"/market-img/placeholder-product.jpg")},ef=async e=>{if(e.preventDefault(),!ee.name){J("\xdcr\xfcn adı gereklidir");return}if(!ee.price){J("\xdcr\xfcn fiyatı gereklidir");return}if(!ee.points){J("\xdcr\xfcn puanı gereklidir");return}if(!ee.category){J("Kategori se\xe7melisiniz");return}try{Y(!0);let e=ee.imageUrl;if(z)try{e=await ey(z,M?ee.imageUrl:void 0),console.log("Image uploaded successfully:",e)}catch(t){console.error("Error uploading image:",t),S.toast.error("Resim y\xfcklenemedi, ama \xfcr\xfcn kaydedilecek"),e=M?ee.imageUrl:""}let t={id:M||(0,$.Z)(),name:ee.name,price:ex(ee.price,ee.priceType),points:parseInt(ee.points?.toString()||"0"),category:ee.category,description:ee.description||"",imageUrl:e,stock:ee.virtual?-1:parseInt(ee.stock?.toString()||"0"),featured:ee.featured,virtual:ee.virtual,priceValue:ee.price};M?E(e=>e.map(e=>e.id===t.id?t:e)):E(e=>[...e,t]);let r=M?T.map(e=>e.id===t.id?t:e):[...T,t];localStorage.setItem(C,JSON.stringify(r));let a=!1,s="";try{let e=M?{item:t}:{items:r},l=await fetch("/api/market/items",{method:M?"PATCH":"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache"},cache:"no-store",body:JSON.stringify(e)}),i=await l.json();a=i.success,s="Saved via API",console.log("API response:",i)}catch(e){console.error("API saving failed:",e);try{console.log("Trying direct Supabase save...");let e=await en(r);a=e.success,s="Saved directly to database",console.log("Items saved directly to Supabase:",e)}catch(e){console.error("Supabase saving failed:",e),a=!0,s="Saved to local storage only (offline mode)"}}a||s.includes("local storage")?(S.toast.success(M?"\xdcr\xfcn başarıyla g\xfcncellendi!":"Yeni \xfcr\xfcn başarıyla eklendi!"),s.includes("local storage")&&(0,S.toast)("\xdcr\xfcn sadece yerel olarak saklandı. \xc7evrimi\xe7i olduğunuzda senkronize edilecek.",{icon:"⚠️",duration:5e3}),q(!1),et({name:"",price:0,points:0,category:"betting",description:"",imageUrl:"",stock:-1,featured:!1,virtual:!1,priceType:"TRY"}),_(null),R(null),setTimeout(async()=>{await eh(),ec()},500)):S.toast.error("\xdcr\xfcn kaydedilirken bir hata oluştu")}catch(e){console.error("Form submission error:",e),S.toast.error("Beklenmeyen bir hata oluştu")}finally{Y(!1)}},eb=e=>{let{name:t,value:r}=e.target;ea(e=>({...e,[t]:"points"===t?parseInt(r)||0:r}))};return((0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/list-market-images");if(e.ok){let t=await e.json();Array.isArray(t.images)?(el(t.images),console.log("Loaded market images:",t.images)):(console.error("Invalid images data format:",t),el(["/market-img/zlat.png","/market-img/default.png"]))}else console.error("Failed to load market images:",e.statusText),el(["/market-img/zlat.png","/market-img/default.png"])}catch(e){console.error("Error loading market images:",e),el(["/market-img/zlat.png","/market-img/default.png"])}})()},[]),r)?a.jsx(N.Z,{children:a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-t-blue-500 border-blue-200 rounded-full animate-spin mb-4 mx-auto"}),a.jsx("p",{className:"text-gray-400",children:"Y\xfckleniyor..."})]})})}):(0,a.jsxs)(N.Z,{children:[(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(o.default,{href:"/admin",className:"flex items-center text-blue-400 hover:text-blue-300 mb-2",children:[a.jsx(c.Z,{className:"w-5 h-5 mr-1"})," Admin Paneline D\xf6n"]}),a.jsx("h1",{className:"text-3xl font-bold text-white",children:"Market Y\xf6netimi"}),a.jsx("p",{className:"text-gray-400",children:"\xdcr\xfcnleri ekle, d\xfczenle veya sil"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("button",{onClick:eh,className:"text-gray-400 hover:text-blue-400 p-2 rounded-md",disabled:V,title:"Verileri Yenile",children:V?a.jsx(d.Z,{className:"w-5 h-5 animate-spin"}):a.jsx(m.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"\xdcr\xfcn ara...",className:"bg-gray-700 text-white px-4 py-2 pl-10 rounded-md w-64 focus:outline-none focus:ring-2 focus:ring-blue-500",value:A,onChange:e=>I(e.target.value)}),a.jsx(u.Z,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),(0,a.jsxs)("button",{onClick:eg,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center",disabled:F,children:[a.jsx(g.Z,{className:"w-5 h-5 mr-1.5"})," Yeni \xdcr\xfcn"]})]})]}),O&&(0,a.jsxs)("div",{className:"bg-red-900/50 border border-red-800 text-red-100 px-4 py-3 rounded-md mb-6 flex items-start",children:[a.jsx(p.Z,{className:"w-5 h-5 text-red-400 mr-2 mt-0.5"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Hata oluştu"}),a.jsx("p",{className:"text-sm",children:O})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-8",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[a.jsx(x,{className:"mr-2 text-blue-400"})," Bahis Siteleri Ekle"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-gray-400 text-sm",children:"Site Adı"}),a.jsx("input",{type:"text",placeholder:"\xf6r. Zlot1000",className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",name:"name",value:er.name,onChange:eb})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-gray-400 text-sm",children:"JackPoint Değeri"}),a.jsx("input",{type:"number",placeholder:"\xf6r. 3500",className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",name:"points",value:er.points,onChange:eb})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-gray-400 text-sm",children:"Logo Se\xe7"}),(0,a.jsxs)("select",{className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",name:"imageUrl",value:er.imageUrl,onChange:eb,children:[a.jsx("option",{value:"",children:"Logo Se\xe7"}),es.map((e,t)=>a.jsx("option",{value:e,children:e.split("/").pop()},t))]})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{if(!er.name.trim()){S.toast.error("Site adı gereklidir");return}if(!er.points){S.toast.error("JackPoint değeri gereklidir");return}if(!er.imageUrl){S.toast.error("Logo se\xe7imi gereklidir");return}let e=[...T,{id:(0,$.Z)(),name:er.name.trim(),price:"30$",points:er.points,category:"betting",description:"Market \xdczerinden Satın alma işlemi ger\xe7ekleştirdikten sonra Telegram Grubu \xfczerinden bizlere "+er.name+" kullanıcı adınızı iletmeniz Gerekmektedir.",imageUrl:er.imageUrl,stock:-1,featured:!0,virtual:!0,priceValue:30}];E(e),localStorage.setItem(C,JSON.stringify(e)),en(e).then(e=>{e.success?console.log("Partner site saved to Supabase:",e):console.warn("Partner site saved to localStorage only:",e.message)}).catch(e=>{console.error("Error saving partner site:",e)}),ea({name:"",points:3500,imageUrl:"/market-img/zlat.png"}),S.toast.success("Bahis sitesi başarıyla eklendi"),ec(),setTimeout(()=>{eh().catch(e=>console.error("Refresh error:",e))},500)},className:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md",children:"Bahis Sitesi Ekle"})})]}),a.jsx("div",{className:"text-gray-400 text-sm",children:'Not: Bahis siteleri otomatik olarak "Bahis Sitesi" kategorisinde eklenecektir.'})]}),(0,a.jsxs)("div",{className:"flex mb-6 space-x-2 overflow-x-auto pb-2",children:[a.jsx("button",{onClick:()=>I(""),className:`px-4 py-2 rounded-full whitespace-nowrap ${""===A?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"T\xfcm \xdcr\xfcnler"}),a.jsx("button",{onClick:()=>I("betting"),className:`px-4 py-2 rounded-full whitespace-nowrap ${"betting"===A?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Bahis Siteleri"})]}),0===eu.length?(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-8 text-center",children:[a.jsx(y.Z,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"\xdcr\xfcn bulunamadı"}),a.jsx("p",{className:"text-gray-400 mb-6",children:"Arama kriterlerinize uygun \xfcr\xfcn bulunamadı."}),(0,a.jsxs)("button",{onClick:eg,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md inline-flex items-center",children:[a.jsx(g.Z,{className:"w-5 h-5 mr-1.5"})," Yeni \xdcr\xfcn Ekle"]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:eu.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden shadow-lg",children:[(0,a.jsxs)("div",{className:"relative h-48",children:[e.imageUrl?a.jsx("div",{className:"w-full h-full bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${e.imageUrl.includes("?")?e.imageUrl:`${e.imageUrl}?t=${Date.now()}`})`}}):a.jsx("div",{className:"flex items-center justify-center h-full bg-gray-700",children:a.jsx(f,{className:"w-16 h-16 text-gray-600"})}),e.featured&&a.jsx("span",{className:"absolute top-2 right-2 bg-yellow-500 text-black text-xs font-medium px-2 py-1 rounded-full",children:"\xd6ne \xc7ıkan"})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("h3",{className:"text-lg font-medium text-white",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>ep(e),className:"text-blue-400 hover:text-blue-300",title:"D\xfczenle",disabled:K===e.id,children:a.jsx(b.Z,{className:"w-5 h-5"})}),a.jsx("button",{onClick:()=>ed(e.id),className:"text-red-400 hover:text-red-300",title:"Sil",disabled:K===e.id,children:K===e.id?a.jsx(d.Z,{className:"w-5 h-5 animate-spin"}):a.jsx(k.Z,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"text-gray-400 text-sm mb-2 line-clamp-2",title:e.description,children:e.description||"A\xe7ıklama yok"}),a.jsx("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(w.Z,{className:"w-5 h-5 text-yellow-500 mr-1.5"}),(0,a.jsxs)("span",{className:"text-white font-medium",children:[e.points||0," Jackpoint"]})]})})]})]},e.id))})]}),Z&&a.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg max-w-3xl w-full max-h-[90vh] overflow-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h3",{className:"text-xl font-bold text-white",children:M?"\xdcr\xfcn D\xfczenle":"Yeni \xdcr\xfcn Ekle"}),a.jsx("button",{onClick:()=>q(!1),className:"text-gray-400 hover:text-white",disabled:F,children:a.jsx(v.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("form",{onSubmit:ef,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-gray-400",children:["\xdcr\xfcn Adı ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",name:"name",value:ee.name,onChange:e=>et({...ee,name:e.target.value}),className:`w-full bg-gray-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${Q.name?"border border-red-500":""}`,placeholder:"\xdcr\xfcn adı",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-gray-400",children:["JackPoint Değeri ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",name:"points",value:ee.points,onChange:e=>et({...ee,points:parseInt(e.target.value)||0}),className:`w-full bg-gray-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${Q.points?"border border-red-500":""}`,placeholder:"JackPoint değeri",min:"0",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-gray-400",children:["Fiyat ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"flex",children:[a.jsx("input",{type:"number",name:"price",value:ee.price,onChange:e=>et({...ee,price:parseFloat(e.target.value)||0}),className:`flex-1 bg-gray-700 text-white px-4 py-2 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${Q.price?"border border-red-500":""}`,placeholder:"Fiyat değeri",min:"0",step:"0.01",required:!0}),(0,a.jsxs)("select",{name:"priceType",value:ee.priceType,onChange:e=>et({...ee,priceType:e.target.value}),className:"bg-gray-700 text-white px-3 py-2 rounded-r-md border-l border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"TRY",children:"₺"}),a.jsx("option",{value:"USD",children:"$"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-gray-400",children:"Stok Durumu"}),a.jsx("input",{type:"number",name:"stock",value:ee.stock,onChange:e=>et({...ee,stock:parseInt(e.target.value)||0}),className:"w-full bg-gray-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Stok adedi",min:"0",disabled:ee.virtual})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-gray-300",children:"A\xe7ıklama"}),a.jsx("textarea",{name:"description",value:ee.description,onChange:e=>et({...ee,description:e.target.value}),className:"w-full h-24 px-3 py-2 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"\xdcr\xfcn a\xe7ıklaması"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"virtual",name:"virtual",checked:ee.virtual,onChange:e=>et({...ee,virtual:e.target.checked}),className:"h-4 w-4 bg-gray-700 border-gray-600 rounded text-blue-500 focus:ring-blue-500"}),a.jsx("label",{htmlFor:"virtual",className:"ml-2 text-sm text-gray-300",children:"Stok Takibi Yapma"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"featured",name:"featured",checked:ee.featured,onChange:e=>et({...ee,featured:e.target.checked}),className:"h-4 w-4 bg-gray-700 border-gray-600 rounded text-blue-500 focus:ring-blue-500"}),a.jsx("label",{htmlFor:"featured",className:"ml-2 text-sm text-gray-300",children:"\xd6ne \xc7ıkan \xdcr\xfcn"})]}),a.jsx("input",{type:"hidden",name:"category",value:"betting"})]}),O&&(0,a.jsxs)("div",{className:"bg-red-900/50 border border-red-800 text-red-100 px-4 py-3 rounded-md mb-6 flex items-start",children:[a.jsx(p.Z,{className:"w-5 h-5 text-red-400 mr-2 mt-0.5"}),a.jsx("p",{children:O})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[a.jsx("button",{type:"button",onClick:()=>q(!1),className:"px-6 py-2 rounded-md border border-gray-600 text-gray-300 hover:bg-gray-700",disabled:F,children:"İptal"}),a.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 flex items-center",disabled:F,children:F?(0,a.jsxs)(a.Fragment,{children:[a.jsx(d.Z,{className:"w-5 h-5 mr-2 animate-spin"}),"İşleniyor..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(j.Z,{className:"w-5 h-5 mr-2"}),M?"G\xfcncelle":"Kaydet"]})})]})]})]})})})]})}},23503:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>l,__esModule:()=>s,default:()=>i});let a=(0,r(86843).createProxy)(String.raw`E:\copycoder-2025-04-13T00-58-05-829Z\src\app\admin\market\page.tsx`),{__esModule:s,$$typeof:l}=a,i=a.default},60139:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(6113);let s={randomUUID:a.randomUUID},l=new Uint8Array(256),i=l.length,o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));let n=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let n=(e=e||{}).random??e.rng?.()??(i>l.length-16&&((0,a.randomFillSync)(l),i=0),l.slice(i,i+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(n)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,5362,337,9410,6506,1017,613,8804],()=>r(49727));module.exports=a})();