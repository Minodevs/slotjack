"use strict";(()=>{var e={};e.id=9327,e.ids=[9327],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},79335:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>x});var o={};t.r(o),t.d(o,{GET:()=>l,POST:()=>d});var s=t(95419),a=t(69108),n=t(99678),i=t(78070),c=t(42509),u=t(1397);async function l(e){try{let{searchParams:r}=new URL(e.url),t=r.get("userId");if(!t)return i.Z.json({error:"User ID is required"},{status:400});let o=await (0,c.e)(),{data:{session:s}}=await o.auth.getSession();if(!s)return i.Z.json({error:"Authentication required"},{status:401});let{data:a,error:n}=await o.from("profiles").select("id, jackPoints, lastUpdated").eq("id",t).single();if(n)return console.error("Error fetching user profile:",n),i.Z.json({error:"Failed to fetch user coins"},{status:500});if(!a)return i.Z.json({error:"User not found"},{status:404});return i.Z.json({id:a.id,jackPoints:a.jackPoints,lastUpdated:a.lastUpdated})}catch(e){return console.error("Unexpected error in GET /api/user/coins:",e),i.Z.json({error:"An unexpected error occurred"},{status:500})}}async function d(e){try{let r=await e.json();if(!r.userId||"number"!=typeof r.amount)return i.Z.json({error:"Invalid request. Required fields: userId, amount"},{status:400});let{userId:t,amount:o,description:s,type:a}=r,n=await (0,c.e)(),{data:l,error:d}=await n.from("users").select("jackPoints, name, email").eq("id",t).single();if(d||!l)return console.error("Error fetching user data:",d),i.Z.json({error:"User not found"},{status:404});let p=l.jackPoints||0,h=p+o;if(h<0)return i.Z.json({error:"Insufficient coins balance"},{status:400});let{error:f}=await n.from("users").update({jackPoints:h}).eq("id",t);if(f)return console.error("Error updating user coins:",f),i.Z.json({error:"Failed to update coins balance"},{status:500});try{await (0,u.dT)({userId:t,userEmail:l.email,userName:l.name||l.email.split("@")[0],amount:o,description:s||(o>0?"Coins added":"Coins spent"),timestamp:Date.now(),type:a||(o>0?"earn":"spend")})}catch(e){console.error("Error creating transaction record:",e)}return i.Z.json({success:!0,previousBalance:p,newBalance:h,difference:o})}catch(e){return console.error("Unexpected error in POST /api/user/coins:",e),i.Z.json({error:"An unexpected error occurred"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/user/coins/route",pathname:"/api/user/coins",filename:"route",bundlePath:"app/api/user/coins/route"},resolvedPagePath:"E:\\copycoder-2025-04-13T00-58-05-829Z\\src\\app\\api\\user\\coins\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:m,headerHooks:g,staticGenerationBailout:x}=p,y="/api/user/coins/route";function b(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},42509:(e,r,t)=>{let o;t.d(r,{e:()=>i});var s=t(24459),a=t(7439);try{o=global.fetch}catch(e){console.warn("Native fetch not available, using polyfill would be needed")}let n=e=>new Promise(r=>setTimeout(r,e)),i=async(e=3)=>{try{console.log("Creating server-side Supabase client...");let r=(0,a.cookies)(),t="https://your-project-id.supabase.co".trim(),i="your-supabase-anon-key".trim();if(!t||!i)throw console.error("Missing Supabase environment variables:",t?"":"NEXT_PUBLIC_SUPABASE_URL",i?"":"NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("Missing required Supabase configuration");let c=null;for(let a=1;a<=e;a++)try{console.log(`Attempt ${a} of ${e} to create Supabase client`);let n=(0,s.lx)(t,i,{cookies:{get:e=>r.get(e)?.value},auth:{persistSession:!1,autoRefreshToken:!1},global:{fetch:o,headers:{"X-Client-Info":"next-server-supabase"}},db:{schema:"public"},realtime:{timeout:1e4}});try{let e=await n.from("health_check").select("*").limit(1).maybeSingle();if(e.error)throw console.warn(`Health check failed on attempt ${a}:`,e.error),e.error;console.log("Supabase server client created and verified successfully")}catch(e){if(e.message&&e.message.includes('relation "health_check" does not exist'))console.log("Health check table does not exist, but connection seems good");else throw e}return n}catch(r){if(c=r,console.error(`Failed to initialize Supabase client (attempt ${a}/${e}):`,r),a<e){let e=Math.min(500*Math.pow(2,a-1),5e3);console.log(`Retrying in ${e}ms...`),await n(e)}}throw Error(`Supabase client initialization failed after ${e} attempts: ${c instanceof Error?c.message:String(c)}`)}catch(e){throw console.error("Error creating Supabase server client:",e),e}}},1397:(e,r,t)=>{t.d(r,{dT:()=>o});let o=async e=>{console.log("TransactionsService.addTransaction called with:",e);try{try{let r=await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok){let e=await r.json();return console.log("Transaction saved via API:",e),e}}catch(e){console.error("Error adding transaction via API:",e)}let r={id:`local_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,...e};return s(r),r}catch(r){return console.error("Error in addTransaction:",r),{id:`local_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,...e}}},s=e=>{}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,7439,4459],()=>t(79335));module.exports=o})();