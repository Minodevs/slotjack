"use strict";(()=>{var e={};e.id=8866,e.ids=[8866],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},20416:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>x});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>p});var s=r(95419),o=r(69108),n=r(99678),i=r(42509),c=r(78070);let l="transactions";async function u(e){try{let t=await (0,i.e)(),r=new URL(e.url),a=r.searchParams.get("userId"),s=r.searchParams.get("limit")?parseInt(r.searchParams.get("limit")):100,o=r.searchParams.get("page")?parseInt(r.searchParams.get("page")):1,n=r.searchParams.get("type"),u=t.from(l).select("*").order("timestamp",{ascending:!1});a&&(u=u.eq("userId",a)),n&&(u=u.eq("type",n));let p=(o-1)*s;u=u.range(p,p+s-1);let{data:d,error:g,count:h}=await u;if(g)return console.error("Error fetching transactions:",g),c.Z.json({error:"Failed to fetch transactions"},{status:500});return c.Z.json({transactions:d,meta:{page:o,limit:s,total:h,hasMore:d.length===s}})}catch(e){return console.error("Error handling transaction request:",e),c.Z.json({error:"Internal server error"},{status:500})}}async function p(e){try{console.log("POST /api/transactions - Starting request processing");let t=await (0,i.e)(),r=await e.json();if(console.log("Transaction data received:",r),!r.userId||!r.userEmail||(r.amount,0)||!r.type||!r.description)return console.error("Missing required fields in transaction data:",r),c.Z.json({error:"Missing required fields"},{status:400});r.timestamp||(r.timestamp=Date.now()),console.log("Inserting transaction into Supabase:",r);let{data:a,error:s}=await t.from(l).insert([r]).select("*").single();if(s)return console.error("Error adding transaction to Supabase:",s),c.Z.json({error:`Failed to add transaction: ${s.message}`},{status:500});return console.log("Transaction added successfully:",a),c.Z.json(a,{status:201})}catch(e){return console.error("Unhandled error in transaction POST request:",e),c.Z.json({error:"Internal server error",details:e instanceof Error?e.message:String(e)},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/transactions/route",pathname:"/api/transactions",filename:"route",bundlePath:"app/api/transactions/route"},resolvedPagePath:"E:\\copycoder-2025-04-13T00-58-05-829Z\\src\\app\\api\\transactions\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:f,staticGenerationBailout:x}=d,y="/api/transactions/route";function b(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},42509:(e,t,r)=>{let a;r.d(t,{e:()=>i});var s=r(24459),o=r(7439);try{a=global.fetch}catch(e){console.warn("Native fetch not available, using polyfill would be needed")}let n=e=>new Promise(t=>setTimeout(t,e)),i=async(e=3)=>{try{console.log("Creating server-side Supabase client...");let t=(0,o.cookies)(),r="https://your-project-id.supabase.co".trim(),i="your-supabase-anon-key".trim();if(!r||!i)throw console.error("Missing Supabase environment variables:",r?"":"NEXT_PUBLIC_SUPABASE_URL",i?"":"NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("Missing required Supabase configuration");let c=null;for(let o=1;o<=e;o++)try{console.log(`Attempt ${o} of ${e} to create Supabase client`);let n=(0,s.lx)(r,i,{cookies:{get:e=>t.get(e)?.value},auth:{persistSession:!1,autoRefreshToken:!1},global:{fetch:a,headers:{"X-Client-Info":"next-server-supabase"}},db:{schema:"public"},realtime:{timeout:1e4}});try{let e=await n.from("health_check").select("*").limit(1).maybeSingle();if(e.error)throw console.warn(`Health check failed on attempt ${o}:`,e.error),e.error;console.log("Supabase server client created and verified successfully")}catch(e){if(e.message&&e.message.includes('relation "health_check" does not exist'))console.log("Health check table does not exist, but connection seems good");else throw e}return n}catch(t){if(c=t,console.error(`Failed to initialize Supabase client (attempt ${o}/${e}):`,t),o<e){let e=Math.min(500*Math.pow(2,o-1),5e3);console.log(`Retrying in ${e}ms...`),await n(e)}}throw Error(`Supabase client initialization failed after ${e} attempts: ${c instanceof Error?c.message:String(c)}`)}catch(e){throw console.error("Error creating Supabase server client:",e),e}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,7439,4459],()=>r(20416));module.exports=a})();