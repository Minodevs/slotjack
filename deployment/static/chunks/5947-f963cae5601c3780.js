"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5947],{5947:function(e,t,r){r.r(t),r.d(t,{AuthContext:function(){return _},AuthProvider:function(){return A},UserRank:function(){return a},useAuth:function(){return O}});var o,a,s=r(3827),n=r(4090),i=r(7907),l=r(3107),c=r(2171);let d="slotjack_auth_token",u="slotjack_user",g=l.Z.create({baseURL:"/api/auth",headers:{"Content-Type":"application/json"}});g.interceptors.request.use(e=>{let t=f();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e));let m=e=>{localStorage.setItem(d,e)},f=()=>localStorage.getItem(d),h=()=>{localStorage.removeItem(d)},p=e=>{localStorage.setItem(u,JSON.stringify(e))},v=()=>{localStorage.removeItem(u)},y=async(e,t,r)=>{try{let o=await g.post("/register",{email:e,password:t,name:r});return m(o.data.token),p(o.data.user),o.data}catch(e){var o,a;throw(null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.error)||"Registration failed"}},w=async(e,t)=>{try{let r=await g.post("/login",{email:e,password:t});m(r.data.token),p(r.data.user);try{console.log("Creating test login transaction for user:",r.data.user),await (0,c.dT)({userId:r.data.user.id,userEmail:r.data.user.email,userName:r.data.user.name||r.data.user.email.split("@")[0],amount:10,description:"Login bonus",timestamp:Date.now(),type:"bonus"}),console.log("Test transaction created successfully")}catch(e){console.error("Failed to create test transaction:",e)}return r.data}catch(e){var r,o;throw(null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.error)||"Login failed"}},S=()=>{h(),v()},k=async e=>{try{let t=await g.put("/update-profile",e);return p(t.data.user),t.data}catch(e){var t,r;throw(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to update profile"}};var b=r(1097);(o=a||(a={})).ADMIN="admin",o.VIP="vip",o.NORMAL="normal";let _=(0,n.createContext)(void 0),j="slotjack_user",E="slotjack_registered_users",I="slotjack_leaderboard",N=(e,t,r)=>({id:Math.random().toString(36).substring(2,15),amount:e,description:t,timestamp:Date.now(),type:r});function A(e){let{children:t}=e,[r,o]=(0,n.useState)(null),[a,l]=(0,n.useState)(!0),[d,u]=(0,n.useState)(null),[g,m]=(0,n.useState)([]),[f,h]=(0,n.useState)({isLive:!1,url:""}),[p,v]=(0,n.useState)(!1),[A,O]=(0,n.useState)(!1),P=(0,i.useRouter)(),L=(0,i.usePathname)(),T=e=>{if(e!==L){if(O(!0),l(!0),"/liderlik-tablosu"===L){console.log("Hard navigating from leaderboard context"),window.location.href=e;return}setTimeout(()=>{try{P.push(e)}catch(t){console.error("Router navigation failed:",t),window.location.href=e}setTimeout(()=>{O(!1),l(!1)},250)},50)}};(0,n.useEffect)(()=>{v(!0);let e=setTimeout(()=>{try{let e=localStorage.getItem(j);if(e)try{let t=JSON.parse(e);t.transactions||(t.transactions=[]),t.lastUpdated||(t.lastUpdated=Date.now()),void 0===t.hasReceivedInitialBonus&&(t.hasReceivedInitialBonus=t.jackPoints>=150),void 0===t.rank&&(t.rank="normal"),t.email&&"sezarpaypals2@gmail.com"===t.email.toLowerCase()&&(t.rank="admin"),o(t)}catch(e){console.error("Failed to parse stored user")}C();let t=e=>{if(!e.key)return;let t=Date.now();if(a&&t-a<100){console.log("Throttling storage event to prevent loops");return}if(a=t,e.key===j&&e.newValue)try{let t=JSON.parse(e.newValue);JSON.stringify(r)!==JSON.stringify(t)&&(console.log("User data updated from another tab/browser"),o(t))}catch(e){console.error("Failed to parse user data from storage event",e)}if(e.key===E&&(console.log("Registered users changed in another tab"),C()),e.key===I&&e.newValue)try{let t=JSON.parse(e.newValue);JSON.stringify(g)!==JSON.stringify(t)&&(console.log("Leaderboard updated from another tab/browser"),m(t))}catch(e){console.error("Failed to parse leaderboard data from storage event",e)}},a=0;return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}}catch(e){console.error("Error accessing localStorage:",e)}finally{l(!1)}},300);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if(p)try{let e=localStorage.getItem("slotjack_livestream");e&&h(JSON.parse(e))}catch(e){console.error("Error loading livestream status:",e)}},[]);let C=()=>{if(p)try{let e=localStorage.getItem(I);if(e){let t=JSON.parse(e).map(e=>{var t;let r=["admin@example.com","sezarpaypals2@gmail.com","vip@example.com","normal@example.com","user1@example.com","user2@example.com"].includes(null===(t=e.email)||void 0===t?void 0:t.toLowerCase());return{...e,rank:e.rank||"normal",isVerified:void 0!==e.isVerified?e.isVerified:!r}});m(t),localStorage.setItem(I,JSON.stringify(t))}else{let e=J(),t=Object.values(e).map((e,t)=>({id:Math.random().toString(36).substring(2,15),email:e.email,name:e.name||e.email.split("@")[0],jackPoints:Math.floor(15e3*Math.random())+1e3,transactions:[],lastUpdated:Date.now(),hasReceivedInitialBonus:e.hasReceivedInitialBonus||!1,rank:e.rank||"normal",isVerified:!1,avatar:void 0,phoneNumber:void 0,phoneVerified:void 0}));t.sort((e,t)=>t.jackPoints-e.jackPoints),localStorage.setItem(I,JSON.stringify(t)),m(t)}}catch(e){console.error("Failed to refresh leaderboard:",e)}},J=()=>{if(!p)return{};console.log("Getting registered users from all storage locations...");let e={};try{try{let t=localStorage.getItem(E);if(t){let r=JSON.parse(t);Object.entries(r).forEach(t=>{let[r,o]=t;e[r.toLowerCase()]=o}),console.log("Found ".concat(Object.keys(e).length," users in localStorage"))}}catch(e){console.error("Failed to parse registered users from localStorage:",e)}try{let t=sessionStorage.getItem(E);if(t){let r=JSON.parse(t);Object.entries(r).forEach(t=>{let[r,o]=t;e[r.toLowerCase()]||(e[r.toLowerCase()]=o)}),console.log("Added ".concat(Object.keys(r).length," users from sessionStorage"))}}catch(e){console.error("Failed to get users from sessionStorage:",e)}try{if(window.__slotjack_shared_data&&window.__slotjack_shared_data[E]){let t=window.__slotjack_shared_data[E];Object.entries(t).forEach(t=>{let[r,o]=t;e[r.toLowerCase()]||(e[r.toLowerCase()]=o)}),console.log("Added users from global window object")}}catch(e){console.error("Failed to get users from global window object:",e)}try{let t=localStorage.getItem("slotjack_global_users");if(t){let r=JSON.parse(t);Object.entries(r).forEach(t=>{let[r,o]=t;e[r.toLowerCase()]||(e[r.toLowerCase()]=o)}),console.log("Added users from simulated backend")}}catch(e){console.error("Failed to get users from simulated backend:",e)}try{for(let t of document.cookie.split(";").filter(e=>e.trim().startsWith("slotjack_registered_user_")))try{let r=t.trim().split("=");if(2!==r.length)continue;let o=r[0].replace("slotjack_registered_user_","").toLowerCase(),a=decodeURIComponent(r[1]),s=JSON.parse(a);(!e[o]||s.lastLogin&&(!e[o].lastLogin||s.lastLogin>e[o].lastLogin))&&(e[o]=s,console.log("Added/updated user ".concat(o," from cookies")))}catch(e){console.error("Error parsing user cookie:",e)}}catch(e){console.error("Error checking for user cookies:",e)}if(Object.keys(e).length>0)try{localStorage.setItem(E,JSON.stringify(e))}catch(e){console.error("Failed to update localStorage with merged users:",e)}else console.log("No registered users found in any storage location");return e}catch(e){return console.error("Error accessing user storage:",e),{}}},R=e=>{if(p)try{let t=[...g],r=t.findIndex(t=>t.email===e.email);-1!==r?t[r]={...t[r],jackPoints:e.jackPoints,lastUpdated:Date.now(),hasReceivedInitialBonus:e.hasReceivedInitialBonus,rank:e.rank,isVerified:e.isVerified,name:e.name,avatar:e.avatar,phoneNumber:e.phoneNumber,phoneVerified:e.phoneVerified,socialAccounts:e.socialAccounts}:t.push({...e,lastUpdated:Date.now()}),t.sort((e,t)=>t.jackPoints-e.jackPoints),localStorage.setItem(I,JSON.stringify(t)),m(t)}catch(e){console.error("Error accessing localStorage:",e)}},U=async(e,t)=>{try{l(!0),u(null);let{user:r}=await w(e,t);o(r),C();return}catch(e){throw console.error("Login error:",e),u(e.toString()),e}finally{l(!1)}},x=async(e,t,r)=>{try{l(!0),u(null);let{user:a}=await y(e,t,r);o(a),C();return}catch(e){throw console.error("Registration error:",e),u(e.toString()),e}finally{l(!1)}},F=async()=>{try{l(!0),u(null),S(),o(null),T("/")}catch(e){console.error("Logout error:",e),u("\xc7ıkış sırasında bir hata oluştu. L\xfctfen tekrar deneyin.")}finally{l(!1)}},V=async(e,t,a)=>{if(!r)return null;try{let u=N(e,t,a),g={...r,jackPoints:r.jackPoints+e,transactions:[u,...r.transactions],lastUpdated:Date.now()};localStorage.setItem(j,JSON.stringify(g)),o(g),R(g);try{var s,n,i,l,d;let o=await (0,b.e)(),{error:m}=await o.from("profiles").update({jackPoints:g.jackPoints,lastUpdated:g.lastUpdated}).eq("id",r.id);m?console.error("Error updating jackPoints in Supabase:",m):console.log("Successfully updated jackPoints in Supabase"),console.log("Saving transaction to database:",{id:u.id,userId:r.id,userEmail:r.email,userName:r.name,amount:e,description:t,timestamp:u.timestamp,type:a});let f=await (0,c.dT)({userId:r.id,userEmail:r.email,userName:r.name,amount:e,description:t,timestamp:u.timestamp,type:a,userPhone:r.phoneNumber,userSocialMedia:{telegram:null===(s=r.socialAccounts)||void 0===s?void 0:s.telegram,discord:null===(n=r.socialAccounts)||void 0===n?void 0:n.discord,instagram:null===(i=r.socialAccounts)||void 0===i?void 0:i.instagram,twitter:null===(l=r.socialAccounts)||void 0===l?void 0:l.twitter,facebook:null===(d=r.socialAccounts)||void 0===d?void 0:d.facebook}});console.log("Transaction saved successfully:",f)}catch(o){console.error("Failed to save transaction to database:",o);try{await (0,c.dT)({userId:r.id,userEmail:r.email,userName:r.name||"",amount:e,description:t,timestamp:u.timestamp,type:a})}catch(e){console.error("Retry also failed:",e)}}return u}catch(e){return console.error("Error updating jackPoints:",e),null}},M=async e=>{if(!r)return!1;try{l(!0);let t=await k(e);if(t.success)return o(t.user),!0;return!1}catch(e){return console.error("Error updating profile:",e),!1}finally{l(!1)}},B=async(e,t)=>{if(!p||!r)return!1;try{return l(!0),!0}catch(e){return console.error("Error updating password:",e),!1}finally{l(!1)}};return(0,s.jsx)(_.Provider,{value:{user:r,loading:a,error:d,signIn:U,signUp:x,signOut:F,updateJackPoints:V,getRecentTransactions:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return r&&r.transactions?[...r.transactions].sort((e,t)=>t.timestamp-e.timestamp).slice(0,e):[]},updateProfile:M,updatePassword:B,leaderboard:g,refreshLeaderboard:C,navigate:T,livestream:f,updateLivestream:e=>{h(e),p&&localStorage.setItem("slotjack_livestream",JSON.stringify(e))}},children:t})}function O(){let e=(0,n.useContext)(_);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1097:function(e,t,r){r.d(t,{e:function(){return n}});var o=r(1182);let a=e=>new Promise(t=>setTimeout(t,e)),s=async e=>{try{let{error:t}=await e.from("health_check").select("*").limit(1).maybeSingle();if(t){if(t.message&&(t.message.includes('relation "health_check" does not exist')||t.message.includes("does not exist")))return console.log("Supabase connection test successful (health_check table not found)"),{success:!0,online:!0};return console.error("Supabase connection test failed:",t),{success:!1,error:t,online:!1}}return{success:!0,online:!0}}catch(e){return console.error("Supabase connection test exception:",e),{success:!1,error:e,online:!1,message:e instanceof Error?e.message:String(e)}}},n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;try{var t,r;console.log("Creating browser-side Supabase client...");let n=(t="https://your-project-id.supabase.co",void 0===t)?void 0:t.trim(),i=(r="your-supabase-anon-key",void 0===r)?void 0:r.trim();if(!n||!i)throw console.error("Missing Supabase environment variables:",n?"":"NEXT_PUBLIC_SUPABASE_URL",i?"":"NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("Missing required Supabase configuration");let l=null;for(let t=1;t<=e;t++)try{console.log("Attempt ".concat(t," of ").concat(e," to create browser Supabase client"));let r=(0,o.AY)(n,i),a=await s(r);if(!a.success)throw console.warn("Connection test failed on attempt ".concat(t,":"),a.error),Error(a.message||"Connection test failed");return console.log("Supabase browser client created and verified successfully"),r}catch(r){if(l=r,console.error("Failed to initialize browser Supabase client (attempt ".concat(t,"/").concat(e,"):"),r),t<e){let e=Math.min(300*Math.pow(2,t-1),3e3);console.log("Retrying in ".concat(e,"ms...")),await a(e)}}throw Error("Supabase browser client initialization failed after ".concat(e," attempts: ").concat(l instanceof Error?l.message:String(l)))}catch(e){throw console.error("Error creating Supabase browser client:",e),e}}},2171:function(e,t,r){r.d(t,{_v:function(){return a},dT:function(){return s}});let o="slotjack_transactions_cache",a=async()=>{console.log("TransactionsService.getAllTransactions called");try{try{console.log("Attempting to fetch transactions from API...");let t=await fetch("/api/transactions");if(t.ok){var e;let r=await t.json();return console.log("Successfully fetched ".concat((null===(e=r.transactions)||void 0===e?void 0:e.length)||0," transactions from API")),r.transactions}}catch(e){console.error("Error fetching transactions from API:",e)}return n()}catch(e){return console.error("Error in getAllTransactions:",e),[]}},s=async e=>{console.log("TransactionsService.addTransaction called with:",e);try{try{let t=await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();return console.log("Transaction saved via API:",e),e}}catch(e){console.error("Error adding transaction via API:",e)}let t={id:"local_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9)),...e};return i(t),t}catch(t){return console.error("Error in addTransaction:",t),{id:"local_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9)),...e}}},n=()=>{try{if(window.localStorage){let e=localStorage.getItem(o);if(e)return JSON.parse(e)}}catch(e){console.error("Error retrieving cached transactions:",e)}return[]},i=e=>{try{if(window.localStorage){let t=n(),r=t.findIndex(t=>t.id===e.id);r>=0?t[r]=e:t.push(e),localStorage.setItem(o,JSON.stringify(t))}}catch(e){console.error("Error updating transaction cache:",e)}}}}]);